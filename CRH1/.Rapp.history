d<-read.delim("Meth_Data.txt")#
d2<-read.delim("Align_to_CRH1.txt")#
d2$Location<-seq(1,nrow(d2),1)#
#
cpgnum<-67#
#
library(car)#
#
d$sresp1<-d$stress1-d$base1#
d$sresp3<-d$stress3-d$base3#
d$dresp1<-d$stress1-d$dex1#
d$dresp3<-d$stress3-d$dex3#
d$l_sresp1<-log(d$sresp1+6)#
d$l_sresp3<-log(d$sresp3)#
d$l_dresp1<-log(d$stress1)-log(d$dex1)#
d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
assays<-read.delim("CRH1_Assay_Locs.txt")
par(fig=c(0,1,0,1))#
		d3<-d2#
		plot(d3$Location,d3$Meth,bty="n",ylim=c(0,100),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
			xlab="CpG site number",type="n",las=2,yaxs="i")#
		for(i in 1:nrow(d3)){#
			lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
		}#
		points(d3$Location,d3$Meth,pch=21,bg="gray70")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		#abline(v=73.5,lty=2,col="red"
storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
	}#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
		}#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))
## Code to plot CRH methylation data. Updated 11/20/2018#
#
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_CRH1.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("CRH1_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)
cpgnum<-67
add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-rep("black",nrow(assays))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}
d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()
add.assay(95,-4,2.5)
storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)
for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu
# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-7,128,"Control +M",col="slateblue",pos=4)	#
			text(-7,112,"Color +M",col="orange",pos=4)
plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(0,128,"Control +M",col="slateblue",pos=4)	#
			text(0,112,"Color +M",col="orange",pos=4)
text(-3,128,"Control +M",col="slateblue",pos=4)	#
			text(-3,112,"Color +M",col="orange",pos=4)
plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)
plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-7,128,"Control +M",col="slateblue",pos=4)	#
			text(-7,108,"Stress +M",col="orange",pos=4)
plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-2,128,"Control +M",col="slateblue",pos=4)	#
			text(-2,108,"Stress +M",col="orange",pos=4)
## Color manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-7,6.6,"Control +M",pos=4,col="slateblue")#
			text(-7,5.4,"Dulled +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Dulled +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat2=="Control"),subset(d[,i+8],d$Treat2=="Stress"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat2)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="lightblue",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Stress +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Age=="ASY"),subset(d[,i+8],d$Age=="SY"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Age)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="yellow",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Age T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"ASY +M",pos=4,col="slateblue")#
			text(-2,5.4,"SY +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$b.bright)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$b.bright,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Breast Brightness Regression",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Brighter +M",pos=4,col="slateblue")#
			text(-2,5.4,"Duller +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base2)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base2,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 2",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress3)#
			test2<-lm(scale(d[,i+8])~scale(d$stress3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$sresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number in relation to ATG",bty="n",main="Dex response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")
storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$dresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")
storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base1+d$stress1+d$dex1))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 1")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")
storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(-276,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(-276,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(-276,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")
text(0,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)
text(1,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)
storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(1,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(1,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(1,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")
storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		two.way.mods<-list()#
		two.way.mods2<-list()#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1+d$Treat2),type="III")#
			test2<-summary(lm(d[,i+8]~d$Treat1+d$Treat2))#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			two.way.mods[[i]]<-test#
			two.way.mods2[[i]]<-test2#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color + Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(1,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(1,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(1,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment"),pch=21,pt.bg=c("orange","lightblue"),bty="n")
pspot<-1
storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1*d$Treat2),type="III")#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			storagel3[i]<- -log(test["Pr(>F)"][4,1],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color*Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment","Color*Stress"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")
pspot<-1#
#
# Set whether to plot to a device (1) or two window (0)#
	plot.to.dev<-1#
# Write functions used for making similar plots or additions later#
	# This adds the lines for assay positions to a plot#
		add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-rep("black",nrow(assays))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}#
	# This function adds exons and ATG starg codonto a plot#
		add.exons<-function(ATG=73.5,ylow=100,yhigh=110,wsize=1){#
			abline(v=ATG,lty=2,col="red")#
			rect(73.5,ylow,88.5,yhigh,col="gray70")#
			text(81,mean(c(ylow,yhigh)),"Exon 1",cex=wsize)#
			rect(93.5,ylow,108.5,yhigh,col="gray70")#
			text(101,mean(c(ylow,yhigh)),"Exon 2",cex=wsize)#
			rect(124.5,ylow,137.5,yhigh,col="gray70")#
			text(131,mean(c(ylow,yhigh)),"Exon 3",cex=wsize)#
		}#
#
# Determining whether all the following plots are sent to pdf or device#
	if(plot.to.dev==1){#
		pdf("Output_Methylation_Profile_CRH1.pdf",width=12.4,height=6)#
		}#
#
# Make a barplot of percent methylation across the entire region sampled for an overall view of the gene#
		d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()#
		add.assay(95,-4,2.5)#
## Make a plot showing correlation between consecutive CpG sites#
	storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)	#
## Compare two level factor means#
	for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu#
	# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)#
#
	## Plot for stress control vs. stress	#
		plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-2,128,"Control +M",col="slateblue",pos=4)	#
			text(-2,108,"Stress +M",col="orange",pos=4)#
## Make plot of one way t-tests for each predictor#
	## Color manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Dulled +M",pos=4,col="orange")#
	## Stress manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat2=="Control"),subset(d[,i+8],d$Treat2=="Stress"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat2)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="lightblue",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Stress +M",pos=4,col="orange")#
	## Age#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Age=="ASY"),subset(d[,i+8],d$Age=="SY"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Age)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="yellow",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Age T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"ASY +M",pos=4,col="slateblue")#
			text(-2,5.4,"SY +M",pos=4,col="orange")#
	## breast brightness regression#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$b.bright)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$b.bright,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Breast Brightness Regression",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Brighter +M",pos=4,col="slateblue")#
			text(-2,5.4,"Duller +M",pos=4,col="orange")#
	## base cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## base cort 2#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base2)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base2,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 2",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## base cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress3)#
			test2<-lm(scale(d[,i+8])~scale(d$stress3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## sresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")#
	## sresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$sresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")			#
	## dresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number in relation to ATG",bty="n",main="Dex response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")		#
	## dresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$dresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")	#
## Run as more complicated models#
#
	# main effects base, stress, dex capture 1#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base1+d$stress1+d$dex1))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 1")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
	# main effects base, stress, dex capture 2#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
	# Two way ANOVA with the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		two.way.mods<-list()#
		two.way.mods2<-list()#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1+d$Treat2),type="III")#
			test2<-summary(lm(d[,i+8]~d$Treat1+d$Treat2))#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			two.way.mods[[i]]<-test#
			two.way.mods2[[i]]<-test2#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color + Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment"),pch=21,pt.bg=c("orange","lightblue"),bty="n")#
	## Interaction between the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1*d$Treat2),type="III")#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			storagel3[i]<- -log(test["Pr(>F)"][4,1],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color*Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment","Color*Stress"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
## If plotting to pdf turn device off#
	if(plot.to.dev==1){		#
		dev.off()#
	}
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_CRH1.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("CRH1_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
# Set the number of CpGs that are in the data file (used for loops below)#
	cpgnum<-67#
# where to write p values on x axis#
	pspot<-1#
#
# Set whether to plot to a device (1) or two window (0)#
	plot.to.dev<-1#
# Write functions used for making similar plots or additions later#
	# This adds the lines for assay positions to a plot#
		add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-rep("black",nrow(assays))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}#
	# This function adds exons and ATG starg codonto a plot#
		#add.exons<-function(ATG=73.5,ylow=100,yhigh=110,wsize=1){#
		#	abline(v=ATG,lty=2,col="red")#
		#	rect(73.5,ylow,88.5,yhigh,col="gray70")#
		#	text(81,mean(c(ylow,yhigh)),"Exon 1",cex=wsize)#
		#	rect(93.5,ylow,108.5,yhigh,col="gray70")#
		#	text(101,mean(c(ylow,yhigh)),"Exon 2",cex=wsize)#
		#	rect(124.5,ylow,137.5,yhigh,col="gray70")#
		#	text(131,mean(c(ylow,yhigh)),"Exon 3",cex=wsize)#
		#}#
#
# Determining whether all the following plots are sent to pdf or device#
	if(plot.to.dev==1){#
		pdf("Output_Methylation_Profile_CRH1.pdf",width=12.4,height=6)#
		}#
#
# Make a barplot of percent methylation across the entire region sampled for an overall view of the gene#
		d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()#
		add.assay(95,-4,2.5)#
## Make a plot showing correlation between consecutive CpG sites#
	storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)	#
## Compare two level factor means#
	for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu#
	# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)#
#
	## Plot for stress control vs. stress	#
		plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-2,128,"Control +M",col="slateblue",pos=4)	#
			text(-2,108,"Stress +M",col="orange",pos=4)#
## Make plot of one way t-tests for each predictor#
	## Color manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Dulled +M",pos=4,col="orange")#
	## Stress manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat2=="Control"),subset(d[,i+8],d$Treat2=="Stress"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat2)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="lightblue",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Stress +M",pos=4,col="orange")#
	## Age#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Age=="ASY"),subset(d[,i+8],d$Age=="SY"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Age)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="yellow",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Age T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"ASY +M",pos=4,col="slateblue")#
			text(-2,5.4,"SY +M",pos=4,col="orange")#
	## breast brightness regression#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$b.bright)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$b.bright,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Breast Brightness Regression",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Brighter +M",pos=4,col="slateblue")#
			text(-2,5.4,"Duller +M",pos=4,col="orange")#
	## base cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## base cort 2#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base2)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base2,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 2",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## base cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress3)#
			test2<-lm(scale(d[,i+8])~scale(d$stress3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## sresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")#
	## sresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$sresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")			#
	## dresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number in relation to ATG",bty="n",main="Dex response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")		#
	## dresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$dresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")	#
## Run as more complicated models#
#
	# main effects base, stress, dex capture 1#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base1+d$stress1+d$dex1))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 1")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
	# main effects base, stress, dex capture 2#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
#
	# Two way ANOVA with the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		two.way.mods<-list()#
		two.way.mods2<-list()#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1+d$Treat2),type="III")#
			test2<-summary(lm(d[,i+8]~d$Treat1+d$Treat2))#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			two.way.mods[[i]]<-test#
			two.way.mods2[[i]]<-test2#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color + Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment"),pch=21,pt.bg=c("orange","lightblue"),bty="n")#
		add.assay(3.3,-.15,.1)#
	## Interaction between the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1*d$Treat2),type="III")#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			storagel3[i]<- -log(test["Pr(>F)"][4,1],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color*Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment","Color*Stress"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
## If plotting to pdf turn device off#
	if(plot.to.dev==1){		#
		dev.off()#
	}
## Code to plot CRH methylation data. Updated 11/20/2018#
#
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_NPY.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("NPY_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
# Set the number of CpGs that are in the data file (used for loops below)#
	cpgnum<-52#
# where to write p values on x axis#
	pspot<-1#
#
# Set whether to plot to a device (1) or two window (0)#
	plot.to.dev<-1#
# Write functions used for making similar plots or additions later#
	# This adds the lines for assay positions to a plot#
		add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-rep("black",nrow(assays))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}#
	# This function adds exons and ATG starg codonto a plot#
		#add.exons<-function(ATG=73.5,ylow=100,yhigh=110,wsize=1){#
		#	abline(v=ATG,lty=2,col="red")#
		#	rect(73.5,ylow,88.5,yhigh,col="gray70")#
		#	text(81,mean(c(ylow,yhigh)),"Exon 1",cex=wsize)#
		#	rect(93.5,ylow,108.5,yhigh,col="gray70")#
		#	text(101,mean(c(ylow,yhigh)),"Exon 2",cex=wsize)#
		#	rect(124.5,ylow,137.5,yhigh,col="gray70")#
		#	text(131,mean(c(ylow,yhigh)),"Exon 3",cex=wsize)#
		#}
d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()#
		add.assay(95,-4,2.5)
## Make a plot showing correlation between consecutive CpG sites#
	storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	#abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)
## Compare two level factor means#
	for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu#
	# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			#lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)
## Code to plot CRH methylation data. Updated 11/20/2018#
#
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_NPY.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("NPY_Assay_Locs.txt")
## Code to plot CRH methylation data. Updated 11/20/2018#
#
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_CRH1.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("CRH1_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
# Set the number of CpGs that are in the data file (used for loops below)#
	cpgnum<-67#
# where to write p values on x axis#
	pspot<-1
assays
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_CRH1.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("CRH1_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
# Set the number of CpGs that are in the data file (used for loops below)#
	cpgnum<-67#
# where to write p values on x axis#
	pspot<-1#
#
# Set whether to plot to a device (1) or two window (0)#
	plot.to.dev<-1#
# Write functions used for making similar plots or additions later#
	# This adds the lines for assay positions to a plot#
		add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-c("black","red",rep("black",12),"red",rep("black",5),"red",rep("black",6))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}#
	# This function adds exons and ATG starg codonto a plot#
		#add.exons<-function(ATG=73.5,ylow=100,yhigh=110,wsize=1){#
		#	abline(v=ATG,lty=2,col="red")#
		#	rect(73.5,ylow,88.5,yhigh,col="gray70")#
		#	text(81,mean(c(ylow,yhigh)),"Exon 1",cex=wsize)#
		#	rect(93.5,ylow,108.5,yhigh,col="gray70")#
		#	text(101,mean(c(ylow,yhigh)),"Exon 2",cex=wsize)#
		#	rect(124.5,ylow,137.5,yhigh,col="gray70")#
		#	text(131,mean(c(ylow,yhigh)),"Exon 3",cex=wsize)#
		#}#
#
# Determining whether all the following plots are sent to pdf or device#
	if(plot.to.dev==1){#
		pdf("Output_Methylation_Profile_CRH1.pdf",width=12.4,height=6)#
		}#
#
# Make a barplot of percent methylation across the entire region sampled for an overall view of the gene#
		d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()#
		add.assay(95,-4,2.5)#
## Make a plot showing correlation between consecutive CpG sites#
	storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)	#
## Compare two level factor means#
	for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu#
	# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)#
#
	## Plot for stress control vs. stress	#
		plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-2,128,"Control +M",col="slateblue",pos=4)	#
			text(-2,108,"Stress +M",col="orange",pos=4)#
## Make plot of one way t-tests for each predictor#
	## Color manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Dulled +M",pos=4,col="orange")#
	## Stress manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat2=="Control"),subset(d[,i+8],d$Treat2=="Stress"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat2)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="lightblue",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Stress +M",pos=4,col="orange")#
	## Age#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Age=="ASY"),subset(d[,i+8],d$Age=="SY"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Age)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="yellow",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Age T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"ASY +M",pos=4,col="slateblue")#
			text(-2,5.4,"SY +M",pos=4,col="orange")#
	## breast brightness regression#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$b.bright)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$b.bright,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Breast Brightness Regression",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Brighter +M",pos=4,col="slateblue")#
			text(-2,5.4,"Duller +M",pos=4,col="orange")#
	## base cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## base cort 2#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base2)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base2,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 2",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## base cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress3)#
			test2<-lm(scale(d[,i+8])~scale(d$stress3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## sresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")#
	## sresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$sresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")			#
	## dresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number in relation to ATG",bty="n",main="Dex response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")		#
	## dresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$dresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")	#
## Run as more complicated models#
#
	# main effects base, stress, dex capture 1#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base1+d$stress1+d$dex1))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 1")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
	# main effects base, stress, dex capture 2#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
#
	# Two way ANOVA with the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		two.way.mods<-list()#
		two.way.mods2<-list()#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1+d$Treat2),type="III")#
			test2<-summary(lm(d[,i+8]~d$Treat1+d$Treat2))#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			two.way.mods[[i]]<-test#
			two.way.mods2[[i]]<-test2#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color + Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment"),pch=21,pt.bg=c("orange","lightblue"),bty="n")#
		add.assay(3.3,-.15,.1)#
	## Interaction between the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1*d$Treat2),type="III")#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			storagel3[i]<- -log(test["Pr(>F)"][4,1],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color*Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment","Color*Stress"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
## If plotting to pdf turn device off#
	if(plot.to.dev==1){		#
		dev.off()#
	}
## Code to plot CRH methylation data. Updated 11/20/2018#
#
## Load libraries to be used#
	library(car)#
	library(plotrix)	#
	library(effsize)#
#
# Load in data.#
	# 'Meth_Data' is the main dataset with a row per bird and methylation at each site.#
		d<-read.delim("Meth_Data.txt")#
	# 'Align' is location data for where the CPGs line up in the gene#
		d2<-read.delim("Align_to_CRH1.txt")#
	# 'assays' has info on where the primer pair assays fall with respect to CpG sites#
		assays<-read.delim("CRH1_Assay_Locs.txt")#
# Manipulate or reorgznise columns in the data#
	d2$Location<-seq(1,nrow(d2),1)#
	d$sresp1<-d$stress1-d$base1#
	d$sresp3<-d$stress3-d$base3#
	d$dresp1<-d$stress1-d$dex1#
	d$dresp3<-d$stress3-d$dex3#
	d$l_sresp1<-log(d$sresp1+6)#
	d$l_sresp3<-log(d$sresp3)#
	d$l_dresp1<-log(d$stress1)-log(d$dex1)#
	d$l_dresp3<-log(d$stress3)-log(d$dex3)#
#
# Set the number of CpGs that are in the data file (used for loops below)#
	cpgnum<-67#
# where to write p values on x axis#
	pspot<-1#
#
# Set whether to plot to a device (1) or two window (0)#
	plot.to.dev<-1#
# Write functions used for making similar plots or additions later#
	# This adds the lines for assay positions to a plot#
		add.assay<-function(yer=-.75,len=.1,labloc=0){#
			as<-as.character(seq(1,nrow(assays),1))#
			cols<-c("black","red",rep("black",12),"red",rep("black",5),"red",rep("black",6))#
			#cols<-c(rep("black",9),"red",rep("black",8),"red",rep("black",3))#
			for(i in 1:nrow(assays)){#
					arrows(assays$Start1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					arrows(assays$End1[i],yer,y1=yer+len,angle=30,col=cols[i],length=.05)#
					lines(c(assays$Start1[i],assays$End1[i]),rep(yer,2),col=cols[i])#
					lab<-i#
					text(mean(c(assays$Start1[i],assays$End1[i])),yer+labloc,as.character(i),cex=0.7,col=cols[i])#
				}#
			}#
	# This function adds exons and ATG starg codonto a plot#
		#add.exons<-function(ATG=73.5,ylow=100,yhigh=110,wsize=1){#
		#	abline(v=ATG,lty=2,col="red")#
		#	rect(73.5,ylow,88.5,yhigh,col="gray70")#
		#	text(81,mean(c(ylow,yhigh)),"Exon 1",cex=wsize)#
		#	rect(93.5,ylow,108.5,yhigh,col="gray70")#
		#	text(101,mean(c(ylow,yhigh)),"Exon 2",cex=wsize)#
		#	rect(124.5,ylow,137.5,yhigh,col="gray70")#
		#	text(131,mean(c(ylow,yhigh)),"Exon 3",cex=wsize)#
		#}#
#
# Determining whether all the following plots are sent to pdf or device#
	if(plot.to.dev==1){#
		pdf("Output_Methylation_Profile_CRH1.pdf",width=12.4,height=6)#
		}#
#
# Make a barplot of percent methylation across the entire region sampled for an overall view of the gene#
		d3<-d2#
			plot(d3$Location,d3$Meth,bty="n",ylim=c(0,110),pch=21,bg="gray70",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number",type="n",las=2,yaxs="i",yaxt="n")#
			for(i in 1:nrow(d3)){#
				lines(rep(d3$Location[i],2),c(d3$Meth[i]+d3$SD[i],d3$Meth[i]-d3$SD[i]),col="gray50")#
			}#
			points(d3$Location,d3$Meth,pch=21,bg="gray70")#
			axis(1,seq(-100,200,20))#
			axis(2,at=seq(0,100,10),las=2)#
		add.exons()#
		add.assay(95,-4,2.5)#
## Make a plot showing correlation between consecutive CpG sites#
	storagec<-rep(NA,cpgnum-1)#
	for(i in 1:(cpgnum-1)){#
		storagec[i]<-cor(d[,i+9],d[,i+10],use="pairwise.complete.obs")#
		}	#
	colset<-rep(NA,cpgnum-1)#
	for(i in 1:length(storagec)){#
		ifelse(storagec[i]>0,colset[i]<-"blue",colset[i]<-"red")#
	}	#
	plot(d3$Location[1:(cpgnum-1)],storagec,bty="n",ylim=c(-1,1),pch=21,bg="slateblue",xaxt="n",ylab="Correlation",#
		xlab="CpG site number",type="n",las=2,yaxs="i",main="Correlation between adjacent CpG sites")#
	abline(h=0,lty=2,col="gray60")#
	lines(d3$Location[1:(cpgnum-1)],storagec)#
	points(d3$Location[1:(cpgnum-1)],storagec,pch=21,bg=colset)#
	axis(1,seq(-40,200,20))		#
	abline(v=73.5,lty=2,col="red")#
	add.assay(labloc=-.1)	#
## Compare two level factor means#
	for(i in 1: cpgnum){#
			d3$ColCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Control")))#
			d3$ColDull[i]<-mean(na.omit(subset(d[,i+8],d$Treat1=="Dull")))#
			d3$StrCont[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Control")))#
			d3$Stress[i]<-mean(na.omit(subset(d[,i+8],d$Treat2=="Stress")))#
			d3$ColCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Control")))#
			d3$ColDull.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat1=="Dull")))#
			d3$StrCont.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Control")))#
			d3$Stress.mu[i]<-mean(na.omit(subset(scale(d[,i+8]),d$Treat2=="Stress")))#
	}#
		d3$col.diff<-d3$ColCont.mu-d3$ColDull.mu#
		d3$str.diff<-d3$StrCont.mu-d3$Stress.mu#
	# Plot for color control vs. color dull#
		plot(d3$Location,d3$ColCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$ColCont,pch=21,bg="white")#
			points(d3$Location,d3$ColDull,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Color Control","Color Dull"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$col.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$col.diff*10+120)#
			points(d3$Location,d3$col.diff*10+120,pch=21,bg=d3$color)			#
			text(-1,128,"Control +M",col="slateblue",pos=4)	#
			text(-1,107,"Color +M",col="orange",pos=4)#
#
	## Plot for stress control vs. stress	#
		plot(d3$Location,d3$StrCont,bty="n",ylim=c(0,140),pch=21,bg="white",xaxt="n",ylab="Average methylation %",#
				xlab="CpG site number in relation to ATG",type="n",las=2,yaxs="i",yaxt="n")#
			points(d3$Location,d3$StrCont,pch=21,bg="white")#
			points(d3$Location,d3$Stress,pch=21,bg="gray55")#
			axis(1,at=seq(-300,300,20))#
			axis(2,at=seq(0,100,20),las=2)#
			lines(rep(-7.5,2),c(0,99),lty=2,col="red")#
			lines(rep(73.5,2),c(0,100),lty=2,col="red")#
			legend("bottomleft",c("Stress Control","Stress"),pch=c(21,21),pt.bg=c("white","gray55"),bty="n")#
			add.assay(100,-5,2.5)#
		# Add in effect sizes above raw values#
			axis(4,at=seq(110,130,10),las=2,labels=c("-1","0","1"))#
			abline(h=120,lty=2,col="gray60")#
			for(i in 1:nrow(d3)){#
			ifelse(d3$str.diff[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
				}#
			lines(d3$Location,d3$str.diff*10+120)#
			points(d3$Location,d3$str.diff*10+120,pch=21,bg=d3$color)			#
			text(-2,128,"Control +M",col="slateblue",pos=4)	#
			text(-2,108,"Stress +M",col="orange",pos=4)#
## Make plot of one way t-tests for each predictor#
	## Color manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat1=="Control"),subset(d[,i+8],d$Treat1=="Dull"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat1)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Color Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Dulled +M",pos=4,col="orange")#
	## Stress manipulation treatment#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Treat2=="Control"),subset(d[,i+8],d$Treat2=="Stress"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Treat2)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="lightblue",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Manipulation T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Control +M",pos=4,col="slateblue")#
			text(-2,5.4,"Stress +M",pos=4,col="orange")#
	## Age#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-t.test(subset(d[,i+8],d$Age=="ASY"),subset(d[,i+8],d$Age=="SY"))#
			storagel[i]<- -log(test$p.value,base=10)#
			storagep[i]<-test$p.value#
			storagee[i]<-cohen.d(d[,i+8]~d$Age)[[3]][1]#
			}#
		plot(d3$Location,storagel,pch=21,bg="yellow",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Age T-Tests",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"ASY +M",pos=4,col="slateblue")#
			text(-2,5.4,"SY +M",pos=4,col="orange")#
	## breast brightness regression#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$b.bright)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$b.bright,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Breast Brightness Regression",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Brighter +M",pos=4,col="slateblue")#
			text(-2,5.4,"Duller +M",pos=4,col="orange")#
	## base cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## base cort 2#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base2)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base2,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 2",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## base cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$base3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$base3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Base Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi base +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low base +M",pos=4,col="orange")#
	## stress cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$stress3)#
			test2<-lm(scale(d[,i+8])~scale(d$stress3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$stress3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stress +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stress +M",pos=4,col="orange")#
	## dex cort 3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dex3)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dex3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex Cort 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dex +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dex +M",pos=4,col="orange")#
	## sresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")#
	## sresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$sresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$sresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$sresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi stresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low stresp +M",pos=4,col="orange")			#
	## dresp1#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp1)#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp1,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number in relation to ATG",bty="n",main="Dex response 1",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")		#
	## dresp3#
		storagel<-rep(NA, cpgnum)#
		storagep<-rep(NA, cpgnum)#
		storagee<-rep(NA,cpgnum)#
		for(i in 1: cpgnum){#
			test<-lm(d[,i+8]~d$dresp3)#
			test2<-lm(scale(d[,i+8])~scale(d$dresp3))#
			storagel[i]<- -log(summary(test)$coefficients[8],base=10)#
			storagep[i]<-summary(test)$coefficients[8]#
			storagee[i]<-cor(d[,i+8],d$dresp3,use="pairwise.complete.obs")#
				}#
		plot(d3$Location,storagel,pch=21,bg="gray50",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,7),xaxt="n",#
			xlab="CpG site number",bty="n",main="Dex response 3",yaxt="n")#
		axis(1,at=seq(-300,300,20))#
		axis(2,at=seq(-1,5,1))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
		lines(rep(73.5,2),c(-1,4.5),lty=2,col="red")#
		add.assay(4.5,-.3,.2)#
		# Add in effect sizes#
			axis(4,at=seq(5,7,1),labels=c("-1","0","1"))#
			abline(h=6,lty=2,col="gray60")#
			for(i in 1:length(storagee)){#
				ifelse(storagee[i]>0,d3$color[i]<-"slateblue",d3$color[i]<-"orange")#
			}#
			lines(d3$Location,storagee+6)#
			points(d3$Location,storagee+6,pch=21,bg=d3$color)#
			text(-2,6.6,"Hi dresp +M",pos=4,col="slateblue")#
			text(-2,5.4,"Low dresp +M",pos=4,col="orange")	#
## Run as more complicated models#
#
	# main effects base, stress, dex capture 1#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base1+d$stress1+d$dex1))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 1")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
	# main effects base, stress, dex capture 2#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-summary(lm(d[,i+8]~d$base3+d$stress3+d$dex3))#
			storagel1[i]<- -log(test$coefficients[2,4],base=10)#
			storagel2[i]<- -log(test$coefficients[3,4],base=10)#
			storagel3[i]<- -log(test$coefficients[4,4],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4.5),xaxt="n",#
			xlab="CpG site number",bty="n",main="Stress series 3")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Base","Stress","Dex"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
#
	# Two way ANOVA with the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		two.way.mods<-list()#
		two.way.mods2<-list()#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1+d$Treat2),type="III")#
			test2<-summary(lm(d[,i+8]~d$Treat1+d$Treat2))#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			two.way.mods[[i]]<-test#
			two.way.mods2[[i]]<-test2#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color + Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment"),pch=21,pt.bg=c("orange","lightblue"),bty="n")#
		add.assay(3.3,-.15,.1)#
	## Interaction between the two treatments#
		storagel1<-rep(NA, cpgnum)#
		storagel2<-rep(NA, cpgnum)#
		storagel3<-rep(NA, cpgnum)#
		for(i in 1: cpgnum){#
			test<-Anova(lm(d[,i+8]~d$Treat1*d$Treat2),type="III")#
			storagel1[i]<- -log(test["Pr(>F)"][2,1],base=10)#
			storagel2[i]<- -log(test["Pr(>F)"][3,1],base=10)#
			storagel3[i]<- -log(test["Pr(>F)"][4,1],base=10)#
				}#
		plot(d3$Location,storagel1,pch=21,bg="orange",ylab=expression('-log'[10]*'(P)'),las=2,ylim=c(0,4),xaxt="n",#
			xlab="CpG site number",bty="n",main="Two-way ANOVA Color*Stress Manipulations")#
		points(d3$Location+0.1,storagel2,pch=21,bg="lightblue")#
		points(d3$Location-0.1,storagel3,pch=21,bg="violet")#
		axis(1,at=c(-300,-250,-200,-150,-100,-50,0,50,100,150,200,250))#
		abline(h=1.30103,lty=2,col="gray55")#
			text(pspot,1.2,"P = 0.05",pos=3,col="gray35",cex=0.8)#
		abline(h=2,lty=2,col="gray55")#
			text(pspot,1.9,"P = 0.01",pos=3,col="gray35",cex=0.8)#
		abline(h=3,lty=2,col="gray55")#
			text(pspot,2.9,"P = 0.001",pos=3,col="gray35",cex=0.8)#
			abline(v=73.5,lty=2,col="red")#
		legend("topright",c("Color treatment","Stress treatment","Color*Stress"),pch=21,#
			pt.bg=c("orange","lightblue","violet"),bty="n")#
		add.assay(3.3,-.15,.1)#
## If plotting to pdf turn device off#
	if(plot.to.dev==1){		#
		dev.off()#
	}
assays
## Assay level reports#
	## Lists for reports#
		start.l<-c(2,23,54)+8#
		end.l<-c(5,41,58)+8#
		mmain.l<-c("CRH1 Assay 2","CRH1 Assay 15","CRH1 Assay 21")#
		nameone.l<-c("CRH1Assay2_Random.pdf","CRH1Assay15_Random.pdf","CRH1Assay21_Random.pdf")#
		nametwo.l<-c("CRH1Assay2_RawByBase.pdf","CRH1Assay15_RawByBase.pdf","CRH1Assay21_Random.pdf")#
		rower.l<-c(2,6,2)#
		labby.ll<-c("CRH1 2: ","CRH1 15: ","CRH1 21: ")#
		labby1.l<-paste(labby.ll,"Color Treat",sep="")#
		labby2.l<-paste(labby.ll,"Stress Treat",sep="")#
		more.lab<-c("Base3","Stress3","Dex3","Brightness")#
		labb.l<-paste(labby.ll)#
#
###
	for(h in 1:length(start.l)){		#
	## Settings for each loop#
		cycles<-5000#
		start.col<-start.l[h]#
		end.col<-end.l[h]#
		numcg<-end.col-start.col+1#
		mmain<-mmain.l[h]#
		resp<-c("Base3","Stress3","Dex3","Bib bright","Color Treat","Stress Treat")#
		nameone<-nameone.l[h]#
		nametwo<-nametwo.l[h]#
		labb<-paste(labby.ll[h],more.lab,sep="")#
		rower<-rower.l[h]#
		coller<-4#
		wider<-8#
		higher<-rower*2#
		labby1<-labby1.l[h]#
		labby2<-labby2.l[h]#
#
## Collect observed values#
	observe<-as.data.frame(matrix(nrow=2,ncol=length(resp)))#
	colnames(observe)<-c("base3","stress3","dex3","bbright","coltrt","strtrt")#
	rownames(observe)<-c("effect","count")#
		stor1<-rep(NA,numcg)#
		stor2<-rep(NA,numcg)#
		stor3<-rep(NA,numcg)#
		stor4<-rep(NA,numcg)#
		stor5<-rep(NA,numcg)#
		stor6<-rep(NA,numcg)#
		for(k in 1:numcg){#
			stor1[k]<-cor(d[,k+start.col-1],d$base3,use="pairwise.complete.obs")#
			stor2[k]<-cor(d[,k+start.col-1],d$stress3,use="pairwise.complete.obs")#
			stor3[k]<-cor(d[,k+start.col-1],d$dex3,use="pairwise.complete.obs")#
			stor4[k]<-cor(d[,k+start.col-1],d$b.bright,use="pairwise.complete.obs")#
			stor5[k]<-cohen.d(d[,k+start.col-1]~d$Treat1,na.rm=TRUE)[[3]][1]#
			stor6[k]<-cohen.d(d[,k+start.col-1]~d$Treat2,na.rm=TRUE)[[3]][1]#
		}#
	observe$base3[1]<-mean(stor1)#
	observe$base3[2]<-length(subset(stor1,stor1>0))#
	observe$stress3[1]<-mean(stor2)#
	observe$stress3[2]<-length(subset(stor2,stor2>0))#
	observe$dex3[1]<-mean(stor3)#
	observe$dex3[2]<-length(subset(stor3,stor3>0))#
	observe$bbright[1]<-mean(stor4)#
	observe$bbright[2]<-length(subset(stor4,stor4>0))#
	observe$coltrt[1]<-mean(stor5)#
	observe$coltrt[2]<-length(subset(stor5,stor5>0))#
	observe$strtrt[1]<-mean(stor6)#
	observe$strtrt[2]<-length(subset(stor6,stor6>0))#
#
# Randmization permutations#
		storagec.b<-rep(NA,numcg)#
		storage.mu.b<-rep(NA,cycles)#
		storage.count.b<-rep(NA,cycles)#
		storagec.s<-rep(NA,numcg)#
		storage.mu.s<-rep(NA,cycles)#
		storage.count.s<-rep(NA,cycles)#
		storagec.d<-rep(NA,numcg)#
		storage.mu.d<-rep(NA,cycles)#
		storage.count.d<-rep(NA,cycles)#
		storagec.bb<-rep(NA,numcg)#
		storage.mu.bb<-rep(NA,cycles)#
		storage.count.bb<-rep(NA,cycles)#
		storagec.tc<-rep(NA,numcg)#
		storage.mu.tc<-rep(NA,cycles)#
		storage.count.tc<-rep(NA,cycles)#
		storagec.ts<-rep(NA,numcg)#
		storage.mu.ts<-rep(NA,cycles)#
		storage.count.ts<-rep(NA,cycles)#
		for(i in 1:cycles){#
				d.rand<-d[,c("base3","stress3","dex3","b.bright","Treat1","Treat2")]#
				d.rand$sort<-runif(nrow(d.rand))#
				d.rand<-d.rand[order(d.rand$sort),]	#
				colnames(d.rand)<-c("base3.r","stress3.r","dex3.r","b.bright.r","Treat1.r","Treat2.r","sort")#
				d2<-d#
				d2<-cbind(d2,d.rand)#
				#basecort#
					for(k in 1:numcg){#
						storagec.b[k]<-cor(d2[,k+start.col-1],d2$base3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.b[i]<-mean(storagec.b)#
					storage.count.b[i]<-length(subset(storagec.b,storagec.b>0))#
				#stresscort#
					for(k in 1:numcg){#
						storagec.s[k]<-cor(d2[,k+start.col-1],d2$stress3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.s[i]<-mean(storagec.s)#
					storage.count.s[i]<-length(subset(storagec.s,storagec.s>0))#
				#dexcort#
					for(k in 1:numcg){#
						storagec.d[k]<-cor(d2[,k+start.col-1],d2$dex3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.d[i]<-mean(storagec.d)#
					storage.count.d[i]<-length(subset(storagec.d,storagec.d>0))#
				#brest bright#
					for(k in 1:numcg){#
						storagec.bb[k]<-cor(d2[,k+start.col-1],d2$b.bright.r,use="pairwise.complete.obs")#
							}#
					storage.mu.bb[i]<-mean(storagec.bb)#
					storage.count.bb[i]<-length(subset(storagec.bb,storagec.bb>0))#
				#treatment color#
					for(k in 1:numcg){#
						storagec.tc[k]<-cohen.d(d2[,k+start.col-1]~d2$Treat1.r,na.rm=TRUE)[[3]][1]#
							}#
					storage.mu.tc[i]<-mean(storagec.tc)#
					storage.count.tc[i]<-length(subset(storagec.tc,storagec.tc>0))#
				#treatment stress#
					for(k in 1:numcg){#
						storagec.ts[k]<-cohen.d(d2[,k+start.col-1]~d2$Treat2.r,na.rm=TRUE)[[3]][1]#
							}#
					storage.mu.ts[i]<-mean(storagec.ts)#
					storage.count.ts[i]<-length(subset(storagec.ts,storagec.ts>0))	#
				print(paste(i," of ",cycles,sep=""))#
				}#
#
# Plot results of randomiztion tests for each predictor#
		r.result<-function(counts,effects,response,obs1=1,obs2=1){#
			par(mfrow=c(1,2))#
			hist(counts,xlab="Count of positive correlations",ylab="Count",main=paste(mmain,response,sep=" "))#
			abline(v=obs1,col="red",lwd=2)#
			#text(obs1,yone,"Observed Count",pos=2,col="red")#
			pobs<-round(length(subset(counts,counts>obs1-.1))/cycles,4)#
			text(.9*(par("usr")[2]-par("usr")[1]),.9*(par("usr")[4]-par("usr")[3]),paste("P = ",pobs,sep=""),pos=2,col="red")#
			hist(effects,xlab="Average correlation across assay",ylab="Count",#
				main=paste(mmain,response))		#
			abline(v=obs2,col="red",lwd=2)#
			#text(obs2,ytwo,"Observed average",pos=2,col="red")#
			pobs2<-round(length(subset(effects,effects>obs2))/cycles,4)#
			text(par("usr")[2]-.1*(par("usr")[2]-par("usr")[1]),.9*(par("usr")[4]-par("usr")[3]),paste("P = ",pobs2,sep=""),pos=2,col="red")#
		}#
	pdf(nameone,width=10,height=6)		#
		r.result(storage.count.b,storage.mu.b,"Basecort3",obs1=observe$base3[2],obs2=observe$base3[1])#
		r.result(storage.count.s,storage.mu.s,"Stresscort3",obs1=observe$stress3[2],obs2=observe$stress3[1])#
		r.result(storage.count.d,storage.mu.d,"Dexcort3",obs1=observe$dex3[2],obs2=observe$dex3[1])#
		r.result(storage.count.bb,storage.mu.bb,"BBright",obs1=observe$bbright[2],obs2=observe$bbright[1])#
		r.result(storage.count.tc,storage.mu.tc,"Color treat",obs1=observe$coltrt[2],obs2=observe$coltrt[1])#
		r.result(storage.count.ts,storage.mu.ts,"Stress treat",obs1=observe$strtrt[2],obs2=observe$strtrt[1])#
	dev.off()#
# Plot raw correlations for each CPG site for each continuous predictor		#
	# Settings#
	pdf(nametwo,width=wider,height=higher)  #change#
										# change#
		par(mar=c(2.1,3.1,2.1,2.1))#
		predi.l<-list(as.vector(d$base3),as.vector(d$stress3),as.vector(d$dex3),as.vector(d$b.bright))#
	for(u in 1:length(predi.l)){#
		par(mfrow=c(rower,coller))#
		maxer<-max(predi.l[[u]])+.1*max(predi.l[[u]])#
		minner<-min(predi.l[[u]]-.4*min(predi.l[[u]]))#
		predi<-predi.l[[u]]#
		for(i in 1:numcg){#
			plot(d[,i+start.col-1]~predi,bty="n",xaxs="i",ylab="",xlab="",main="",pch=21,bg="orange",#
				yaxt="n",xaxt="n",xlim=c(minner,maxer))#
			axis(1,seq(0,200,10))#
			axis(2,seq(0,100,5),las=2)#
			abline(lm(d[,i+start.col-1]~predi),col="black",lwd=2)	#
			corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labb[u])#
		dx<-d#
		#for(i in 1:13){#
		#	dx[,i+36]<-scale(dx[,i+36])#
		#}#
		for(i in 1:nrow(dx)){#
			sub<-as.data.frame(t(dx[i,start.col:end.col]))#
			dx$avg[i]<-mean(sub[,1])#
			}#
		plot(dx$avg~predi,bty="n",xaxs="i",ylab="",xlab="",main="",pch=21,bg="slateblue",#
			yaxt="n",xaxt="n",xlim=c(minner,maxer))#
		axis(1,seq(0,200,10))#
		axis(2,seq(0,100,5),las=2)#
		abline(lm(dx$avg~predi),col="black",lwd=2)#
		corner.label("Average",1,1)	#
	}#
	par(mfrow=c(rower,coller))#
	for(i in 1:numcg){#
		plot(d[,i+start.col-1]~rep(1,nrow(d)),xlim=c(.5,2.5),type="n",bty="n",xaxt="n",yaxt="n",xaxs="i")#
		axis(1,seq(0,3,1),labels=c("","Control","Dull",""))#
		axis(2,seq(-10,100,10))#
		sub1<-subset(d,d$Treat1=="Control")#
		points(rep(1,nrow(sub1))+runif(nrow(sub1),-.15,.15),sub1[,i+start.col-1],pch=21,bg="orange")#
		sub2<-subset(d,d$Treat1=="Dull")#
		points(rep(2,nrow(sub2))+runif(nrow(sub2),-.15,.15),sub2[,i+start.col-1],pch=21,bg="lightblue")#
		mu1<-mean(na.omit(sub1[,i+start.col-1]))#
		se1<-sd(na.omit(sub1[,i+start.col-1]))/sqrt(nrow(sub1))#
		lines(rep(1.3,2),c(mu1-se1,mu1+se1))#
		points(1.3,mu1,pch=22,bg="orange",cex=1.6)#
		mu2<-mean(na.omit(sub2[,i+start.col-1]))#
		se2<-sd(na.omit(sub2[,i+start.col-1]))/sqrt(nrow(sub2))#
		lines(rep(1.7,2),c(mu2-se2,mu2+se2))#
		points(1.7,mu2,pch=22,bg="lightblue",cex=1.6)#
		corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labby1)#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
	par(mfrow=c(rower,coller))#
		for(i in 1:numcg){#
		plot(d[,i+start.col-1]~rep(1,nrow(d)),xlim=c(.5,2.5),type="n",bty="n",xaxt="n",yaxt="n",xaxs="i")#
		axis(1,seq(0,3,1),labels=c("","Control","Stress",""))#
		axis(2,seq(-10,100,10))#
		sub1<-subset(d,d$Treat2=="Control")#
		points(rep(1,nrow(sub1))+runif(nrow(sub1),-.15,.15),sub1[,i+start.col-1],pch=21,bg="orange")#
		sub2<-subset(d,d$Treat2=="Stress")#
		points(rep(2,nrow(sub2))+runif(nrow(sub2),-.15,.15),sub2[,i+start.col-1],pch=21,bg="lightblue")#
		mu1<-mean(na.omit(sub1[,i+start.col-1]))#
		se1<-sd(na.omit(sub1[,i+start.col-1]))/sqrt(nrow(sub1))#
		lines(rep(1.3,2),c(mu1-se1,mu1+se1))#
		points(1.3,mu1,pch=22,bg="orange",cex=1.6)#
		mu2<-mean(na.omit(sub2[,i+start.col-1]))#
		se2<-sd(na.omit(sub2[,i+start.col-1]))/sqrt(nrow(sub2))#
		lines(rep(1.7,2),c(mu2-se2,mu2+se2))#
		points(1.7,mu2,pch=22,bg="lightblue",cex=1.6)#
		corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labby2)#
	dev.off()#
	}
nametwo.l<-c("CRH1Assay2_RawByBase.pdf","CRH1Assay15_RawByBase.pdf","CRH1Assay21_RawByBase.pdf")
nameone.l<-c("CRH1Assay2_Random.pdf","CRH1Assay15_Random.pdf","CRH1Assay21_Random.pdf")
h<-3
## Settings for each loop#
		cycles<-5000#
		start.col<-start.l[h]#
		end.col<-end.l[h]#
		numcg<-end.col-start.col+1#
		mmain<-mmain.l[h]#
		resp<-c("Base3","Stress3","Dex3","Bib bright","Color Treat","Stress Treat")#
		nameone<-nameone.l[h]#
		nametwo<-nametwo.l[h]#
		labb<-paste(labby.ll[h],more.lab,sep="")#
		rower<-rower.l[h]#
		coller<-4#
		wider<-8#
		higher<-rower*2#
		labby1<-labby1.l[h]#
		labby2<-labby2.l[h]#
#
## Collect observed values#
	observe<-as.data.frame(matrix(nrow=2,ncol=length(resp)))#
	colnames(observe)<-c("base3","stress3","dex3","bbright","coltrt","strtrt")#
	rownames(observe)<-c("effect","count")#
		stor1<-rep(NA,numcg)#
		stor2<-rep(NA,numcg)#
		stor3<-rep(NA,numcg)#
		stor4<-rep(NA,numcg)#
		stor5<-rep(NA,numcg)#
		stor6<-rep(NA,numcg)#
		for(k in 1:numcg){#
			stor1[k]<-cor(d[,k+start.col-1],d$base3,use="pairwise.complete.obs")#
			stor2[k]<-cor(d[,k+start.col-1],d$stress3,use="pairwise.complete.obs")#
			stor3[k]<-cor(d[,k+start.col-1],d$dex3,use="pairwise.complete.obs")#
			stor4[k]<-cor(d[,k+start.col-1],d$b.bright,use="pairwise.complete.obs")#
			stor5[k]<-cohen.d(d[,k+start.col-1]~d$Treat1,na.rm=TRUE)[[3]][1]#
			stor6[k]<-cohen.d(d[,k+start.col-1]~d$Treat2,na.rm=TRUE)[[3]][1]#
		}#
	observe$base3[1]<-mean(stor1)#
	observe$base3[2]<-length(subset(stor1,stor1>0))#
	observe$stress3[1]<-mean(stor2)#
	observe$stress3[2]<-length(subset(stor2,stor2>0))#
	observe$dex3[1]<-mean(stor3)#
	observe$dex3[2]<-length(subset(stor3,stor3>0))#
	observe$bbright[1]<-mean(stor4)#
	observe$bbright[2]<-length(subset(stor4,stor4>0))#
	observe$coltrt[1]<-mean(stor5)#
	observe$coltrt[2]<-length(subset(stor5,stor5>0))#
	observe$strtrt[1]<-mean(stor6)#
	observe$strtrt[2]<-length(subset(stor6,stor6>0))#
#
# Randmization permutations#
		storagec.b<-rep(NA,numcg)#
		storage.mu.b<-rep(NA,cycles)#
		storage.count.b<-rep(NA,cycles)#
		storagec.s<-rep(NA,numcg)#
		storage.mu.s<-rep(NA,cycles)#
		storage.count.s<-rep(NA,cycles)#
		storagec.d<-rep(NA,numcg)#
		storage.mu.d<-rep(NA,cycles)#
		storage.count.d<-rep(NA,cycles)#
		storagec.bb<-rep(NA,numcg)#
		storage.mu.bb<-rep(NA,cycles)#
		storage.count.bb<-rep(NA,cycles)#
		storagec.tc<-rep(NA,numcg)#
		storage.mu.tc<-rep(NA,cycles)#
		storage.count.tc<-rep(NA,cycles)#
		storagec.ts<-rep(NA,numcg)#
		storage.mu.ts<-rep(NA,cycles)#
		storage.count.ts<-rep(NA,cycles)#
		for(i in 1:cycles){#
				d.rand<-d[,c("base3","stress3","dex3","b.bright","Treat1","Treat2")]#
				d.rand$sort<-runif(nrow(d.rand))#
				d.rand<-d.rand[order(d.rand$sort),]	#
				colnames(d.rand)<-c("base3.r","stress3.r","dex3.r","b.bright.r","Treat1.r","Treat2.r","sort")#
				d2<-d#
				d2<-cbind(d2,d.rand)#
				#basecort#
					for(k in 1:numcg){#
						storagec.b[k]<-cor(d2[,k+start.col-1],d2$base3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.b[i]<-mean(storagec.b)#
					storage.count.b[i]<-length(subset(storagec.b,storagec.b>0))#
				#stresscort#
					for(k in 1:numcg){#
						storagec.s[k]<-cor(d2[,k+start.col-1],d2$stress3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.s[i]<-mean(storagec.s)#
					storage.count.s[i]<-length(subset(storagec.s,storagec.s>0))#
				#dexcort#
					for(k in 1:numcg){#
						storagec.d[k]<-cor(d2[,k+start.col-1],d2$dex3.r,use="pairwise.complete.obs")#
							}#
					storage.mu.d[i]<-mean(storagec.d)#
					storage.count.d[i]<-length(subset(storagec.d,storagec.d>0))#
				#brest bright#
					for(k in 1:numcg){#
						storagec.bb[k]<-cor(d2[,k+start.col-1],d2$b.bright.r,use="pairwise.complete.obs")#
							}#
					storage.mu.bb[i]<-mean(storagec.bb)#
					storage.count.bb[i]<-length(subset(storagec.bb,storagec.bb>0))#
				#treatment color#
					for(k in 1:numcg){#
						storagec.tc[k]<-cohen.d(d2[,k+start.col-1]~d2$Treat1.r,na.rm=TRUE)[[3]][1]#
							}#
					storage.mu.tc[i]<-mean(storagec.tc)#
					storage.count.tc[i]<-length(subset(storagec.tc,storagec.tc>0))#
				#treatment stress#
					for(k in 1:numcg){#
						storagec.ts[k]<-cohen.d(d2[,k+start.col-1]~d2$Treat2.r,na.rm=TRUE)[[3]][1]#
							}#
					storage.mu.ts[i]<-mean(storagec.ts)#
					storage.count.ts[i]<-length(subset(storagec.ts,storagec.ts>0))	#
				print(paste(i," of ",cycles,sep=""))#
				}#
#
# Plot results of randomiztion tests for each predictor#
		r.result<-function(counts,effects,response,obs1=1,obs2=1){#
			par(mfrow=c(1,2))#
			hist(counts,xlab="Count of positive correlations",ylab="Count",main=paste(mmain,response,sep=" "))#
			abline(v=obs1,col="red",lwd=2)#
			#text(obs1,yone,"Observed Count",pos=2,col="red")#
			pobs<-round(length(subset(counts,counts>obs1-.1))/cycles,4)#
			text(.9*(par("usr")[2]-par("usr")[1]),.9*(par("usr")[4]-par("usr")[3]),paste("P = ",pobs,sep=""),pos=2,col="red")#
			hist(effects,xlab="Average correlation across assay",ylab="Count",#
				main=paste(mmain,response))		#
			abline(v=obs2,col="red",lwd=2)#
			#text(obs2,ytwo,"Observed average",pos=2,col="red")#
			pobs2<-round(length(subset(effects,effects>obs2))/cycles,4)#
			text(par("usr")[2]-.1*(par("usr")[2]-par("usr")[1]),.9*(par("usr")[4]-par("usr")[3]),paste("P = ",pobs2,sep=""),pos=2,col="red")#
		}#
	pdf(nameone,width=10,height=6)		#
		r.result(storage.count.b,storage.mu.b,"Basecort3",obs1=observe$base3[2],obs2=observe$base3[1])#
		r.result(storage.count.s,storage.mu.s,"Stresscort3",obs1=observe$stress3[2],obs2=observe$stress3[1])#
		r.result(storage.count.d,storage.mu.d,"Dexcort3",obs1=observe$dex3[2],obs2=observe$dex3[1])#
		r.result(storage.count.bb,storage.mu.bb,"BBright",obs1=observe$bbright[2],obs2=observe$bbright[1])#
		r.result(storage.count.tc,storage.mu.tc,"Color treat",obs1=observe$coltrt[2],obs2=observe$coltrt[1])#
		r.result(storage.count.ts,storage.mu.ts,"Stress treat",obs1=observe$strtrt[2],obs2=observe$strtrt[1])#
	dev.off()#
# Plot raw correlations for each CPG site for each continuous predictor		#
	# Settings#
	pdf(nametwo,width=wider,height=higher)  #change#
										# change#
		par(mar=c(2.1,3.1,2.1,2.1))#
		predi.l<-list(as.vector(d$base3),as.vector(d$stress3),as.vector(d$dex3),as.vector(d$b.bright))#
	for(u in 1:length(predi.l)){#
		par(mfrow=c(rower,coller))#
		maxer<-max(predi.l[[u]])+.1*max(predi.l[[u]])#
		minner<-min(predi.l[[u]]-.4*min(predi.l[[u]]))#
		predi<-predi.l[[u]]#
		for(i in 1:numcg){#
			plot(d[,i+start.col-1]~predi,bty="n",xaxs="i",ylab="",xlab="",main="",pch=21,bg="orange",#
				yaxt="n",xaxt="n",xlim=c(minner,maxer))#
			axis(1,seq(0,200,10))#
			axis(2,seq(0,100,5),las=2)#
			abline(lm(d[,i+start.col-1]~predi),col="black",lwd=2)	#
			corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labb[u])#
		dx<-d#
		#for(i in 1:13){#
		#	dx[,i+36]<-scale(dx[,i+36])#
		#}#
		for(i in 1:nrow(dx)){#
			sub<-as.data.frame(t(dx[i,start.col:end.col]))#
			dx$avg[i]<-mean(sub[,1])#
			}#
		plot(dx$avg~predi,bty="n",xaxs="i",ylab="",xlab="",main="",pch=21,bg="slateblue",#
			yaxt="n",xaxt="n",xlim=c(minner,maxer))#
		axis(1,seq(0,200,10))#
		axis(2,seq(0,100,5),las=2)#
		abline(lm(dx$avg~predi),col="black",lwd=2)#
		corner.label("Average",1,1)	#
	}#
	par(mfrow=c(rower,coller))#
	for(i in 1:numcg){#
		plot(d[,i+start.col-1]~rep(1,nrow(d)),xlim=c(.5,2.5),type="n",bty="n",xaxt="n",yaxt="n",xaxs="i")#
		axis(1,seq(0,3,1),labels=c("","Control","Dull",""))#
		axis(2,seq(-10,100,10))#
		sub1<-subset(d,d$Treat1=="Control")#
		points(rep(1,nrow(sub1))+runif(nrow(sub1),-.15,.15),sub1[,i+start.col-1],pch=21,bg="orange")#
		sub2<-subset(d,d$Treat1=="Dull")#
		points(rep(2,nrow(sub2))+runif(nrow(sub2),-.15,.15),sub2[,i+start.col-1],pch=21,bg="lightblue")#
		mu1<-mean(na.omit(sub1[,i+start.col-1]))#
		se1<-sd(na.omit(sub1[,i+start.col-1]))/sqrt(nrow(sub1))#
		lines(rep(1.3,2),c(mu1-se1,mu1+se1))#
		points(1.3,mu1,pch=22,bg="orange",cex=1.6)#
		mu2<-mean(na.omit(sub2[,i+start.col-1]))#
		se2<-sd(na.omit(sub2[,i+start.col-1]))/sqrt(nrow(sub2))#
		lines(rep(1.7,2),c(mu2-se2,mu2+se2))#
		points(1.7,mu2,pch=22,bg="lightblue",cex=1.6)#
		corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labby1)#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
	par(mfrow=c(rower,coller))#
		for(i in 1:numcg){#
		plot(d[,i+start.col-1]~rep(1,nrow(d)),xlim=c(.5,2.5),type="n",bty="n",xaxt="n",yaxt="n",xaxs="i")#
		axis(1,seq(0,3,1),labels=c("","Control","Stress",""))#
		axis(2,seq(-10,100,10))#
		sub1<-subset(d,d$Treat2=="Control")#
		points(rep(1,nrow(sub1))+runif(nrow(sub1),-.15,.15),sub1[,i+start.col-1],pch=21,bg="orange")#
		sub2<-subset(d,d$Treat2=="Stress")#
		points(rep(2,nrow(sub2))+runif(nrow(sub2),-.15,.15),sub2[,i+start.col-1],pch=21,bg="lightblue")#
		mu1<-mean(na.omit(sub1[,i+start.col-1]))#
		se1<-sd(na.omit(sub1[,i+start.col-1]))/sqrt(nrow(sub1))#
		lines(rep(1.3,2),c(mu1-se1,mu1+se1))#
		points(1.3,mu1,pch=22,bg="orange",cex=1.6)#
		mu2<-mean(na.omit(sub2[,i+start.col-1]))#
		se2<-sd(na.omit(sub2[,i+start.col-1]))/sqrt(nrow(sub2))#
		lines(rep(1.7,2),c(mu2-se2,mu2+se2))#
		points(1.7,mu2,pch=22,bg="lightblue",cex=1.6)#
		corner.label(colnames(d)[i+start.col-1])#
		}#
		plot(1,1,type="n",xaxt="n",yaxt="n",ylab="",xlab="",bty="n")#
		text(1,1,labby2)#
	dev.off()
